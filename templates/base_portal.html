{% extends "base.html" %}
{% load staticfiles %}

{% block content %}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
<link rel="stylesheet" href="{% static 'css/base-portal.css' %}" />

<!-- marker cluster cdn -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.5/MarkerCluster.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.5/MarkerCluster.Default.css" />

{% block portal_content %}

{% endblock portal_content %}
<!-- extras buttons -->
<section class="extras-button-group">
  <button id="show_find_place_container_button" class="extras-button">
    Search for a location
  </button>
  <button id="show_test_url_container_button" class="extras-button">
    Test dataset at an open URL
  </button>
  <!--
  <button id="show_within_polygon_container_button" class="extras-button">
    Get data within a polygon
  </button>
  -->
  <button id="toggle_marker_clusters" class="extras-button">
    Cluster Points Markers
  </button>
</section>
<!-- end extra buttons -->

<!-- container for all the extra stuff -->
<section id="find_place_container">
  <br />
  <div id="nominatim">
    <div class="nominatim-title">Find a place</div>
    <div class="nominatim-description">
      The nominatim function uses the openstreetmap location search function. Enter the name of a place you want to
      search for, for example california, and hit enter. Then select the most appropriate result from the drop down
      menu.
    </div>
    <input id="place_input" class="nominatim-place-input"
     type="text" placeholder="Enter place name here">
    <select id="selector" class="nominatim-place-selector"></select>
    <input id="select_button" class="nominatim-place-select-button"
     type="submit" value="Add to map">
    <input id="place_toggle" class="nominatim-place-toggle-button"
     type="submit" value="Toggle place">
  </div>
  <br />
</section>

<section id="test_url_container">
  <br />
  <div class="test-url-grid">
    <div class="test-url-title">Test a URL</div>
    <input class="test-url-input" id="test_url_input" type="text" placeholder="Enter URL Here">
    <div for="test_url_input">
      Enter a full url that is linked to an open dataset without any cross origin issues into the input and hit enter
      to add it to the map. For example <a href="https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson"
        target="_blank">these earthquake data points</a> can be added to the map with this method.
    </div>
    <div id="test_urls">
      <button id="toggle_test_urls">Toggle test datasets</button>
    </div>
  </div>
  <br />
</section>

<!--
<section id="within_polygon_container">
  <input id="file_name_input" type="text" placeholder="Enter the file name here">
  <button id="save_button">Save to geojson file</button>
</section>
-->

<hr />

<section id="main">

  <div id="mapContainer">
    <div class="custom-popup" id="mapid"></div>
  </div>
  <div id="datasetsContainer">
    {% if dataset %}
      <div name="dataset" id="{{ dataset.pk }}" detail="yeah" value="{{ dataset.ext }}"
      {% if dataset.dataset_password %}

      {% else %}
      url="{{ dataset.url }}"
      {% endif %}
      ></div>
    {% endif %}

    {% if dataset_list %}
    <ul class="nav nav-pills nav-stacked">
      <li>
        <form action="." method="GET">
          <input name="q" type="text" title="Search Datasets" placeholder="Search title, account, author, keyword">
        </form>
      </li>
      <li>
        <button class="btn btn-default btn-block" id="clear_map">
          Clear Map
        </button>
      </li>
    </ul>
    {% else %}
      no
    {% endif %}
  </div>

</section>
<!--
  <div id="datasetsContainer">

    {% if dataset %}
    {% if dataset.dataset_password %}
    <div name="dataset" id="{{ dataset.pk }}" detail="yeah" value="{{ dataset.ext }}">
    </div>
    {% else %}
    <div name="dataset" id="{{ dataset.pk }}" detail="yeah" value="{{ dataset.ext }}" url="{{ dataset.url }}">
    </div>
    {% endif %}
    <div id="clear_map"></div>
    {% else %}


    {% if dataset_list %}
    <ul class="nav nav-pills nav-stacked">
      <li>
        <form action="." method="GET">
          <input name="q" type="text" title="Search Datasets" placeholder="Search title, account, author, keyword">
        </form>
      </li>
      <li>
        <button class="btn btn-default btn-block" id="clear_map">
          Clear Map
        </button>
      </li>
    </ul>


    <div id="dataset-scroll-list">
      {% for dataset in dataset_list %}
      {% if dataset.dataset_password %}
      <div class="btn-group btn-group-justified" role="group">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-default" name="dataset" id="{{ dataset.pk }}" value="{{ dataset.ext }}">
            {{ dataset.title }}
          </button>
        </div>
        <div class="btn-group" role="group">
          <a href="{{ dataset.get_absolute_url }}" type="button" class="btn">
            Dataset page
          </a>
        </div>
      </div>
      {% else %}
      <div class="btn-group btn-group-justified" role="group">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-default" name="dataset" id="{{ dataset.pk }}" value="{{ dataset.ext }}"
            url="{{ dataset.url }}">
            {{ dataset.title }}
          </button>
        </div>
        <div class="btn-group" role="group">
          <a href="{{ dataset.get_absolute_url }}" type="button" class="btn">
            Dataset page
          </a>
        </div>
      </div>
      {% endif %}
      {% endfor %}
      {% else %}
      <a style="color:red" href="{% url 'portal' %}">
        No datasets available. Clear Search.
      </a>
      {% endif %}


      {% endif %}
    </div>
  </div>

</section>
-->

<script src="{% static 'js/bundle.js' %}"></script>

{% endblock content %}